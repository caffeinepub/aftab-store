{
  "kind": "feature_evidence_report",
  "features": [
    {
      "featureId": "feature-update-frontend-src-components-productdetailmodal-tsx-history-management-so-the-modal-closes-on-a-single-click-of-the-close-button-by-properly-coordinating-history-pushstate-window-history-back-and-the-popstate-listener-using-refs-to-avoid-race-conditions-specifically-a-when-open-becomes-true-push-a-history-state-once-and-set-a-historypushedref-flag-b-implement-a-unified-close-handler-guarded-by-isclosingref-that-calls-window-history-back-only-when-a-modal-history-entry-was-pushed-otherwise-calls-onclose-directly-and-does-not-clear-historypushedref-before-triggering-back-c-add-a-popstate-listener-that-while-the-modal-is-open-clears-historypushedref-and-calls-onclose-so-browser-back-and-the-close-button-s-history-back-reliably-closes-the-modal-in-one-action",
      "featureTitle": "Update `frontend/src/components/ProductDetailModal.tsx` history management so the modal closes on a single click of the close button by properly coordinating `history.pushState`, `window.history.back()`, and the `popstate` listener using refs to avoid race conditions. Specifically: (a) when `open` becomes true, push a history state once and set a `historyPushedRef` flag; (b) implement a unified close handler guarded by `isClosingRef` that calls `window.history.back()` only when a modal history entry was pushed (otherwise calls `onClose()` directly) and does not clear `historyPushedRef` before triggering `back()`; (c) add a `popstate` listener that, while the modal is open, clears `historyPushedRef` and calls `onClose()` so browser back (and the close buttonâ€™s `history.back()`) reliably closes the modal in one action.",
      "files": [
        "frontend/src/components/ProductDetailModal.tsx"
      ],
      "components": [
        "authorization@4.0.0",
        "core-infrastructure@1.0.2",
        "shadcn-ui@1.0.0",
        "build-template-react@1.0.0",
        "initial-app@1.0.0",
        "blob-storage@4.0.0",
        "github-export-icp-cli@1.0.0"
      ],
      "testIds": [
        "REQ-1"
      ],
      "confidence": "high"
    }
  ]
}